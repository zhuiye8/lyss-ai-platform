# ===========================================
# Lyss AI Platform 统一环境变量配置模板
# ===========================================
# 
# 使用说明：
# 1. 复制此文件为 .env: cp .env.template .env
# 2. 根据实际环境填入相应的值
# 3. 确保 .env 文件在 .gitignore 中，不要提交到版本控制
# 4. 生产环境请使用更安全的密钥管理方案
#
# 最后更新: 2025-07-18
# ===========================================

# ===========================================
# 基础环境配置
# ===========================================

# 运行环境: development | staging | production
ENVIRONMENT=development

# 调试模式: true | false
DEBUG=true

# 日志级别: DEBUG | INFO | WARNING | ERROR | CRITICAL
LOG_LEVEL=INFO

# 时区设置
TIMEZONE=Asia/Shanghai

# ===========================================
# 安全认证配置 (所有服务共享)
# ===========================================

# JWT配置 - 🚨 生产环境必须更改为强密钥
JWT_SECRET=your-super-secret-jwt-key-here-must-be-at-least-32-characters-long-change-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=30
JWT_REFRESH_EXPIRE_DAYS=7

# PostgreSQL数据库加密密钥 - 🚨 生产环境必须更改
PGCRYPTO_KEY=your-pgcrypto-encryption-key-here-must-be-secure-change-in-production

# 服务间认证密钥 - 🚨 生产环境必须更改
SERVICE_AUTH_SECRET=your-service-auth-secret-key-here-change-in-production

# ===========================================
# 数据库配置
# ===========================================

# PostgreSQL 主数据库
DATABASE_URL=postgresql://lyss:test@localhost:5433/lyss_db
DB_HOST=localhost
DB_PORT=5433
DB_USERNAME=lyss
DB_PASSWORD=test
DB_DATABASE=lyss_db

# 数据库连接池配置
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# ===========================================
# 缓存配置
# ===========================================

# Redis 配置
REDIS_URL=redis://localhost:6380
REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_PASSWORD=
REDIS_DB=0

# 缓存TTL配置 (秒)
CACHE_DEFAULT_TTL=3600
CACHE_USER_PROFILE_TTL=1800
CACHE_TENANT_CONFIG_TTL=7200

# ===========================================
# 服务端口配置
# ===========================================

# 前端服务
FRONTEND_PORT=3000

# API Gateway (统一入口)
API_GATEWAY_PORT=8000

# 认证服务
AUTH_SERVICE_PORT=8001

# 租户服务
TENANT_SERVICE_PORT=8002

# EINO AI服务
EINO_SERVICE_PORT=8003

# 记忆服务
MEMORY_SERVICE_PORT=8004

# ===========================================
# 服务发现配置
# ===========================================

# 服务基础URL (用于服务间调用)
AUTH_SERVICE_URL=http://localhost:8001
TENANT_SERVICE_URL=http://localhost:8002
EINO_SERVICE_URL=http://localhost:8003
MEMORY_SERVICE_URL=http://localhost:8004

# 外部服务URL
FRONTEND_URL=http://localhost:3000

# ===========================================
# 跨域配置
# ===========================================

# CORS允许的源
CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://127.0.0.1:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Content-Type,Authorization,X-Request-ID,X-Tenant-ID,X-User-ID

# ===========================================
# 请求配置
# ===========================================

# 请求超时配置 (秒)
REQUEST_TIMEOUT=30
SERVICE_CALL_TIMEOUT=10

# 请求重试配置
MAX_RETRIES=3
RETRY_DELAY=1

# 速率限制配置
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# ===========================================
# AI服务配置
# ===========================================

# EINO框架配置
EINO_REQUEST_TIMEOUT=30
EINO_MAX_CONCURRENT_EXECUTIONS=100
EINO_WORKFLOW_TIMEOUT=60

# AI供应商配置 (在租户服务中加密存储)
# 这里的密钥仅用于开发测试，生产环境通过租户管理界面配置
OPENAI_API_KEY=your-openai-api-key-here-for-development-only
ANTHROPIC_API_KEY=your-anthropic-api-key-here-for-development-only
GOOGLE_API_KEY=your-google-api-key-here-for-development-only

# ===========================================
# 记忆服务配置
# ===========================================

# Mem0AI配置
MEM0_LLM_PROVIDER=openai
MEM0_LLM_MODEL=gpt-4o-mini
MEM0_LLM_API_KEY=your-openai-api-key-for-mem0
MEM0_EMBEDDING_MODEL=text-embedding-3-small

# 向量数据库配置 (Qdrant)
VECTOR_DB_URL=http://localhost:6333
VECTOR_DB_API_KEY=
VECTOR_DB_COLLECTION=lyss_memory

# ===========================================
# 对象存储配置
# ===========================================

# MinIO配置
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=lyss-storage
MINIO_SECURE=false

# ===========================================
# 监控和日志配置
# ===========================================

# 结构化日志配置
LOG_FORMAT=json
LOG_OUTPUT=stdout
LOG_FILE_PATH=/var/log/lyss/app.log

# 监控配置
ENABLE_METRICS=true
METRICS_PORT=9090

# 追踪配置
ENABLE_TRACING=true
JAEGER_ENDPOINT=http://localhost:14268/api/traces

# Sentry错误追踪 (可选)
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.1

# ===========================================
# 邮件配置 (可选)
# ===========================================

# SMTP配置
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=noreply@lyss.ai
SMTP_FROM_NAME=Lyss AI Platform

# ===========================================
# 文件上传配置
# ===========================================

# 上传限制
MAX_FILE_SIZE=10485760  # 10MB
ALLOWED_FILE_TYPES=pdf,doc,docx,txt,md,png,jpg,jpeg,gif

# 上传目录
UPLOAD_DIR=uploads
TEMP_DIR=temp

# ===========================================
# 安全配置
# ===========================================

# 密码策略
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true

# 会话配置
SESSION_COOKIE_NAME=lyss_session
SESSION_COOKIE_SECURE=false  # 开发环境false，生产环境true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax

# 安全头配置
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000
CSP_POLICY="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"

# ===========================================
# 开发工具配置
# ===========================================

# 热重载配置
RELOAD_ON_CHANGE=true

# API文档配置
SHOW_API_DOCS=true
API_DOCS_URL=/docs
API_REDOC_URL=/redoc

# 数据库迁移配置
AUTO_MIGRATE=true
MIGRATION_DIR=migrations

# ===========================================
# 性能配置
# ===========================================

# 线程池配置
THREAD_POOL_SIZE=10
ASYNC_POOL_SIZE=50

# 内存配置
MAX_MEMORY_USAGE=2048  # MB
MEMORY_THRESHOLD=80    # 百分比

# 连接配置
MAX_CONNECTIONS=1000
KEEP_ALIVE_TIMEOUT=65
CLIENT_TIMEOUT=60

# ===========================================
# 特性开关
# ===========================================

# 功能开关
FEATURE_REGISTRATION=true
FEATURE_PASSWORD_RESET=true
FEATURE_EMAIL_VERIFICATION=true
FEATURE_RATE_LIMITING=true
FEATURE_METRICS=true
FEATURE_TRACING=true

# 实验性功能
EXPERIMENTAL_STREAMING=true
EXPERIMENTAL_CACHING=true
EXPERIMENTAL_VECTORDB=true

# ===========================================
# 多租户配置
# ===========================================

# 租户隔离配置
TENANT_ISOLATION_LEVEL=strict  # strict | standard | loose
MAX_TENANTS_PER_INSTANCE=1000
TENANT_CACHE_TTL=3600

# 默认租户配置
DEFAULT_TENANT_ID=default
DEFAULT_TENANT_NAME=Default Tenant
DEFAULT_TENANT_PLAN=starter

# ===========================================
# 备份和恢复配置
# ===========================================

# 数据库备份
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 每天凌晨2点
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=lyss-backups

# 文件备份
FILE_BACKUP_ENABLED=true
FILE_BACKUP_INTERVAL=24h

# ===========================================
# 自定义配置
# ===========================================

# 应用特定配置
APP_NAME=Lyss AI Platform
APP_VERSION=1.0.0
APP_DESCRIPTION=企业级AI服务聚合与管理平台

# 品牌配置
BRAND_NAME=Lyss
BRAND_LOGO_URL=/static/logo.png
BRAND_PRIMARY_COLOR=#1890ff
BRAND_SECONDARY_COLOR=#722ed1

# 联系信息
CONTACT_EMAIL=support@lyss.ai
CONTACT_PHONE=+86-400-123-4567
CONTACT_ADDRESS=北京市朝阳区科技园区

# ===========================================
# 注释和说明
# ===========================================

# 🚨 安全提醒：
# 1. 生产环境必须更改所有默认密钥
# 2. 使用强密钥生成器生成密钥
# 3. 定期轮换密钥
# 4. 不要在日志中输出敏感信息
# 5. 使用HTTPS保护传输

# 📝 配置说明：
# 1. 所有服务共享此配置文件
# 2. 使用环境变量前缀区分不同服务的配置
# 3. 支持通过Docker环境变量覆盖
# 4. 支持通过Kubernetes ConfigMap/Secret管理

# 🔧 部署说明：
# 1. 开发环境：使用此模板创建 .env 文件
# 2. 测试环境：使用CI/CD变量或配置文件
# 3. 生产环境：使用密钥管理服务 (如AWS Secrets Manager)
# 4. 容器环境：通过环境变量注入

# 📊 监控配置：
# 1. 所有服务都支持Prometheus指标
# 2. 使用Jaeger进行分布式追踪
# 3. 使用Sentry进行错误追踪
# 4. 使用结构化日志便于聚合分析

# 🎯 性能优化：
# 1. 根据实际负载调整连接池大小
# 2. 根据内存使用情况调整缓存TTL
# 3. 根据网络条件调整超时时间
# 4. 启用压缩和缓存提升性能