# Lyss AI Platform - 项目特性与最终需求

## 🎯 项目概述

**Lyss AI Platform** 是一个企业级AI服务聚合与管理平台，采用微服务架构，实现多租户的AI模型集成、编排和治理。平台的核心目标是为企业提供统一的AI服务接入、智能路由和成本管控解决方案。

## 🏗️ 核心架构特性

### 微服务架构设计
- **统一数据库策略**: 单一PostgreSQL实例，表前缀隔离（auth_*, provider_*, chat_*等）
- **混合部署模式**: Docker基础设施服务 + 本地启动微服务，便于开发调试
- **API网关统一入口**: 所有前端请求通过Backend API Gateway统一路由分发
- **服务间通信**: 基于HTTP REST API的松耦合架构

### 核心服务模块

#### 1. Backend API Gateway (✅ 100%完成)
- **端口**: 8000
- **功能**: 统一入口和路由转发，JWT认证集成
- **特性**: 分布式追踪，安全防护，健康检查，支持5000+并发

#### 2. Auth Service (✅ 100%完成)
- **端口**: 8001
- **功能**: 企业级JWT令牌管理和RBAC权限控制
- **特性**: 
  - 多因素认证MFA (TOTP、SMS、Email、备份代码)
  - OAuth2联邦认证 (Google、GitHub、Microsoft，PKCE支持)
  - 安全策略管理 (密码策略、IP控制、审计日志)

#### 3. Provider Service (✅ 100%完成)
- **端口**: 8003
- **功能**: 多供应商AI模型管理和API透明代理
- **特性**:
  - 支持OpenAI、Anthropic、DeepSeek、Google等主流AI供应商
  - 智能负载均衡 (5种算法: 加权随机、轮询、最少连接、最佳性能、自适应)
  - API透明代理 (OpenAI兼容接口，统一错误处理)
  - 配额管理系统 (多租户配额跟踪和限制控制)

#### 4. User Service (🚀 85%完成)
- **端口**: 8002
- **功能**: 用户管理和画像分析
- **特性**:
  - 基于统一数据库架构的SQLAlchemy优化架构
  - 用户管理核心功能 (创建、激活、更新、删除、搜索)
  - 异步数据库会话管理和事务处理
  - 多租户用户关联和权限检查框架

#### 5. Chat Service (🔄 架构重构中)
- **端口**: 8004
- **功能**: AI工作流编排和对话服务
- **特性**:
  - **架构问题**: 当前直接使用EINO集成，违反微服务原则
  - **修复目标**: 改为通过Provider Service获取AI模型凭证
  - 基于Go + Gin框架的高性能架构
  - WebSocket实时通信和流式响应处理

#### 6. Frontend (🎨 80%完成)
- **端口**: 3000
- **功能**: React + TypeScript + Ant Design X现代化前端
- **特性**:
  - 登录功能完全正常，JWT认证集成
  - AI对话页面现代化：使用Ant Design X的Bubble和Sender组件
  - 现代化主题配色方案（浅色主题）
  - ⚠️ **需重构**: 界面架构需优化，侧边栏改为对话历史

## 🔧 技术栈特点

### 后端技术
- **Python**: FastAPI + SQLAlchemy + Pydantic (Auth、User、Provider服务)
- **Go**: Gin + GORM + EINO框架 (Chat服务)
- **数据库**: PostgreSQL (统一数据库架构)
- **缓存**: Redis (分布式锁、会话存储、限流)
- **向量数据库**: Qdrant (语义检索，为Memory Service预留)
- **对象存储**: MinIO (文件上传和多媒体资源)

### 前端技术
- **React 18**: 现代化组件架构
- **TypeScript**: 严格类型检查
- **Ant Design 5.x**: 企业级UI组件库
- **Ant Design X**: AI对话专用组件（Bubble、Sender）
- **Vite**: 高性能构建工具

### 安全与监控
- **认证**: JWT + RBAC权限控制
- **加密**: pgcrypto列级加密存储API密钥
- **多租户**: tenant_id严格数据隔离
- **日志**: 结构化日志 + 请求追踪
- **监控**: 健康检查 + 性能指标收集

## 🎯 最终需求目标

### 立即需要解决的问题 (🔥 高优先级)

#### 1. Chat Service架构修复
- **问题**: Chat Service直接使用EINO API密钥，违反微服务架构
- **解决方案**: 修改为通过Provider Service的`/v1/chat/completions`端点调用AI模型
- **预期结果**: 实现真正的微服务解耦，统一凭证管理

#### 2. 真实API测试
- **目标**: 使用提供的DeepSeek API密钥进行端到端测试
- **测试链路**: Frontend → Backend API Gateway → Chat Service → Provider Service → DeepSeek API
- **验证内容**: 流式响应、错误处理、Token计费、负载均衡

#### 3. Frontend界面优化
- **问题**: 当前界面布局不合理，用户头像冗余
- **目标**: 重构为类似ChatGPT的界面布局
- **改进点**: 
  - 左侧对话历史侧边栏
  - 中间AI对话主区域
  - 智能对话总结功能

### 中期发展目标 (🚀 中优先级)

#### 1. Memory Service开发
- **技术栈**: FastAPI + Mem0AI + Qdrant
- **功能**: 智能对话记忆提取和语义检索
- **集成**: 与Chat Service深度集成，提供个性化上下文

#### 2. 运维监控完善
- **OpenTelemetry**: 分布式追踪和性能监控
- **Prometheus**: 指标收集和告警
- **日志聚合**: 集中式日志分析和查询

#### 3. 企业级功能
- **多租户管理**: 完善的租户隔离和资源配额
- **成本管控**: Token使用量统计和预算告警
- **审计合规**: 完整的操作审计和数据安全

### 长期愿景目标 (⭐ 低优先级)

#### 1. AI工作流编排
- **基于EINO框架**: OptimizedRAG、SimpleChat、ToolCalling工作流
- **可视化编排**: 拖拽式工作流设计器
- **模板市场**: 预定义的AI应用模板

#### 2. 多模态支持
- **图像处理**: 图像生成、识别、编辑
- **语音交互**: 语音转文字、文字转语音
- **文档处理**: PDF、Word、PPT等文档智能解析

#### 3. 生态集成
- **API市场**: 第三方AI服务接入
- **插件系统**: 可扩展的功能插件
- **开放平台**: 面向开发者的API和SDK

## 📊 当前项目状态

### ✅ 已完成 (85%整体进度)
- Auth Service: 100% (企业级认证和权限管理)
- Provider Service: 100% (多供应商AI模型代理)
- Backend API Gateway: 100% (统一入口和路由)
- User Service: 85% (用户管理核心功能)
- Frontend: 80% (现代化AI对话界面)

### 🔄 进行中
- Chat Service架构重构: 修复微服务集成问题
- Frontend界面优化: 对话历史和布局改进

### ⏳ 待开发
- Memory Service: 智能记忆和上下文管理
- 运维监控: 完善的可观测性体系
- 高级AI工作流: 复杂业务场景编排

## 🛠️ 开发环境配置

### 快速启动命令
```bash
# 1. 启动基础设施服务
docker-compose up -d postgres redis qdrant minio

# 2. 启动后端服务
cd backend && uvicorn api_gateway.main:app --reload --port 8000 &
cd auth-service && uvicorn auth_service.main:app --reload --port 8001 &  
cd user-service && uvicorn user_service.main:app --reload --port 8002 &
cd provider-service && uvicorn app.main:app --reload --port 8003 &
cd chat-service && go run cmd/server/main.go &

# 3. 启动前端
cd frontend && npm run dev
```

### 环境要求
- **Docker**: 基础设施服务容器化
- **Python 3.11+**: 后端服务开发
- **Go 1.21+**: Chat Service开发  
- **Node.js 18+**: 前端开发
- **PostgreSQL 15**: 主数据库
- **Redis 7**: 缓存和会话存储

## 🎉 项目价值

### 企业价值
- **成本优化**: 统一AI供应商管理，智能路由最优价格
- **风险控制**: 多供应商故障转移，避免单点依赖
- **合规管理**: 完整审计日志，满足企业合规要求
- **扩展性**: 微服务架构，支持业务快速扩展

### 技术价值
- **现代化架构**: 微服务 + 容器化 + 云原生
- **高性能**: 支持5000+并发，毫秒级响应
- **高可用**: 负载均衡 + 故障转移 + 健康检查
- **开发友好**: 统一规范 + 完整文档 + 测试覆盖

---

**开发团队**: Lyss AI Team  
**最后更新**: 2025-01-24  
**项目版本**: v1.0.0-beta