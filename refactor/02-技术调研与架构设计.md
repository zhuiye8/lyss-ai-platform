# æŠ€æœ¯è°ƒç ”ä¸æ¶æ„è®¾è®¡

## ğŸ“‹ Context7æ·±åº¦æŠ€æœ¯è°ƒç ”

åŸºäºç”¨æˆ·è¦æ±‚ä½¿ç”¨context7å·¥å…·å¯¹æ ¸å¿ƒæŠ€æœ¯é¡¹ç›®çš„æ·±åº¦è°ƒç ”ï¼Œå®Œæˆäº†å¯¹EINOã€Difyã€Open-WebUIã€One-APIã€Mem0AIçš„å…¨é¢æŠ€æœ¯åˆ†æã€‚

---

## ğŸ” æ ¸å¿ƒæŠ€æœ¯å‘ç°

### 1. EINOæ¡†æ¶ - Goè¯­è¨€LLMç¼–æ’æ¡†æ¶

**å…³é”®ä»·å€¼**ï¼š
- **ByteDance/CloudWeGoå®˜æ–¹æ¡†æ¶** - ä¼ä¸šçº§AIç¼–æ’è§£å†³æ–¹æ¡ˆ
- **ç»Ÿä¸€æ¨¡å‹æŠ½è±¡** - æ”¯æŒOpenAIã€Anthropicã€æ™ºè°±AIç­‰ä¸»æµä¾›åº”å•†
- **åŒæ¨¡å¼ç¼–æ’** - Chainï¼ˆåºåˆ—åŒ–ï¼‰+ Graphï¼ˆå¤æ‚å·¥ä½œæµï¼‰
- **åŸç”Ÿæµå¼æ”¯æŒ** - Server-Sent Eventså’ŒWebSocket

**æ ¸å¿ƒæŠ€æœ¯æ¨¡å¼**ï¼š
```go
// Chainæ¨¡å¼ - ç®€å•åºåˆ—åŒ–å¤„ç†
chain, _ := NewChain[map[string]any, *Message]().
    AppendChatTemplate(prompt).
    AppendChatModel(model).
    Compile(ctx)

// Graphæ¨¡å¼ - å¤æ‚å·¥ä½œæµç¼–æ’  
graph := NewGraph[map[string]any, string]()
graph.AddNode("llm", chatModel)
graph.AddNode("parser", outputParser)
graph.AddEdge(START, "llm")
```

### 2. One-API - LLM APIç®¡ç†ä¸åˆ†å‘ç³»ç»Ÿ

**æ ¸å¿ƒæœºåˆ¶**ï¼š
- **Channelæœºåˆ¶** - æ¯ä¸ªAPIå¯†é’¥ä½œä¸ºç‹¬ç«‹Channelï¼Œæ”¯æŒä¼˜å…ˆçº§å’Œæƒé‡
- **Tokenç³»ç»Ÿ** - ç”¨æˆ·é€šè¿‡Tokenè®¿é—®ï¼Œä¸ç›´æ¥æ¥è§¦åŸå§‹APIå¯†é’¥
- **è´Ÿè½½å‡è¡¡** - åŸºäºæƒé‡å’Œä¼˜å…ˆçº§çš„æ™ºèƒ½è·¯ç”±
- **é…é¢ç®¡ç†** - Tokençº§åˆ«çš„ä½¿ç”¨é™åˆ¶å’Œç›‘æ§

**å…³é”®è®¾è®¡æ¨¡å¼**ï¼š
```javascript
// Channelé…ç½®
const CHANNEL_OPTIONS = {
  1: { key: 1, text: "OpenAI", priority: 1, weight: 10 },
  2: { key: 2, text: "Anthropic", priority: 2, weight: 5 }
};

// Tokenç®¡ç†
{
  "id": 1, "name": "default", "key": "sk-xxx",
  "quota": 1000000, "used_quota": 50000,
  "allowed_channels": [1, 2], "status": 1
}
```

### 3. Dify - å·¥ä½œæµç¼–æ’å¹³å°

**æ¶æ„ç‰¹ç‚¹**ï¼š
- **äº‹ä»¶é©±åŠ¨æ¶æ„** - åŸºäºstreaming eventsçš„å®æ—¶å·¥ä½œæµæ‰§è¡Œ
- **èŠ‚ç‚¹åŒ–è®¾è®¡** - LLMã€HTTPã€çŸ¥è¯†æ£€ç´¢ã€æ¡ä»¶åˆ¤æ–­ç­‰æ ‡å‡†åŒ–èŠ‚ç‚¹
- **æµå¼äº‹ä»¶** - å®æ—¶å·¥ä½œæµçŠ¶æ€æ¨é€
- **å˜é‡ç³»ç»Ÿ** - æ”¯æŒå…¨å±€ã€å¯¹è¯çº§ã€èŠ‚ç‚¹çº§å˜é‡ç®¡ç†

**äº‹ä»¶æ¨¡å¼**ï¼š
```json
{
  "event": "workflow_started",
  "task_id": "5ad4cb98-f0c7-4085-b384-88c403be6290",
  "data": {"id": "5ad498-f0c7-4085-b384-88cbe6290"}
}
{
  "event": "node_started",
  "data": {"node_id": "start", "node_type": "start"}
}
```

### 4. Mem0AI - AIè®°å¿†ç®¡ç†å±‚

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
- **æŒä¹…åŒ–è®°å¿†** - è·¨ä¼šè¯çš„ä¸Šä¸‹æ–‡è®°å¿†å­˜å‚¨
- **å‘é‡æ£€ç´¢** - åŸºäºembeddingçš„æ™ºèƒ½è®°å¿†åŒ¹é…  
- **åˆ†å±‚è®°å¿†** - ç”¨æˆ·çº§ã€ä¼šè¯çº§ã€å®ä½“çº§è®°å¿†ç®¡ç†
- **æ™ºèƒ½æ€»ç»“** - è‡ªåŠ¨ç”Ÿæˆè®°å¿†æ‘˜è¦å’Œå…³è”

**æŠ€æœ¯æ¶æ„**ï¼š
```python
# è®°å¿†ç®¡ç†æ¨¡å¼
m = Memory()
m.add("I am working on improving my tennis skills.", user_id="alice")
memories = m.search(query="What are Alice's hobbies?", user_id="alice")

# è®°å¿†ç»“æ„
{
  "id": "m1", "memory": "Alice is working on improving her tennis skills",
  "metadata": {"data": "original_text"}, 
  "created_at": "2024-07-14T10:42:33.172754"
}
```

### 5. Open-WebUI - è‡ªæ‰˜ç®¡AIç•Œé¢

**è®¾è®¡ç†å¿µ**ï¼š
- **ç®€åŒ–æ¶æ„** - ä¸“æ³¨chatåŠŸèƒ½ï¼Œé¿å…è¿‡åº¦å¤æ‚åŒ–
- **ç»Ÿä¸€æŠ½è±¡** - é€šè¿‡é€‚é…å™¨æ¨¡å¼æ”¯æŒå¤šä¾›åº”å•†
- **è½»é‡æƒé™** - åŸºäºJWTçš„ç®€å•æƒé™ç®¡ç†
- **æ’ä»¶æ‰©å±•** - æ”¯æŒFunctionså’ŒToolsæ‰©å±•

---

## ğŸ—ï¸ æœ€ç»ˆæŠ€æœ¯æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Frontend (React + TypeScript + Ant Design X)       â”‚
â”‚                            PORT: 3000                              â”‚
â”‚  ç‰¹ç‚¹: Open-WebUIç®€æ´è®¾è®¡ + Difyæµå¼UIäº¤äº’                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTP/WebSocket
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Gateway (FastAPI)                           â”‚
â”‚                        PORT: 8000                                 â”‚
â”‚  ç‰¹ç‚¹: ç»Ÿä¸€å…¥å£ã€JWTè®¤è¯ã€è¯·æ±‚è·¯ç”±ã€æµå¼ä»£ç†                        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
      â–¼         â–¼         â–¼         â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auth   â”‚ â”‚Tenant/  â”‚ â”‚Provider â”‚ â”‚  Chat   â”‚ â”‚ Memory  â”‚ â”‚Database â”‚
â”‚ Service â”‚ â”‚  User   â”‚ â”‚ Service â”‚ â”‚ Service â”‚ â”‚ Service â”‚ â”‚PostgreSQLâ”‚
â”‚  :8001  â”‚ â”‚ Service â”‚ â”‚  :8003  â”‚ â”‚  :8004  â”‚ â”‚  :8005  â”‚ â”‚  :5432  â”‚
â”‚(FastAPI)â”‚ â”‚  :8002  â”‚ â”‚(FastAPI)â”‚ â”‚(Go+EINO)â”‚ â”‚(FastAPI)â”‚ â”‚+ Redis  â”‚
â”‚         â”‚ â”‚(FastAPI)â”‚ â”‚+One-API â”‚ â”‚+Stream  â”‚ â”‚+Mem0AI  â”‚ â”‚+ Qdrant â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæœåŠ¡è®¾è®¡

#### Provider Service - One-APIæœºåˆ¶
**èŒè´£**: APIå¯†é’¥ç®¡ç†ã€Channel/Tokenæœºåˆ¶ã€è´Ÿè½½å‡è¡¡
**æŠ€æœ¯**: FastAPI + PostgreSQL

```python
class ProviderChannel(BaseModel):
    """ä¾›åº”å•†é€šé“ - ç›´æ¥å€Ÿé‰´One-APIè®¾è®¡"""
    id: UUID
    name: str                    # æ˜¾ç¤ºåç§°ï¼Œå¦‚"å›¢é˜ŸOpenAI"
    type: int                    # ä¾›åº”å•†ç±»å‹: 1=OpenAI, 2=Anthropic
    key: str                     # åŠ å¯†çš„APIå¯†é’¥
    priority: int = 1            # ä¼˜å…ˆçº§(1-100)
    weight: int = 1              # æƒé‡(è´Ÿè½½å‡è¡¡)
    status: int = 1              # çŠ¶æ€: 1=å¯ç”¨, 2=ç¦ç”¨
    quota: Optional[int]         # é…é¢é™åˆ¶

class UserToken(BaseModel):
    """ç”¨æˆ·è®¿é—®Token - One-API Tokenæœºåˆ¶"""
    id: UUID
    user_id: UUID
    key: str                     # å®é™…Token
    allowed_channels: List[int]  # å…è®¸çš„Channel IDåˆ—è¡¨
    quota: Optional[int]         # ç”¨æˆ·é…é¢
```

#### Chat Service - EINO+Difyé›†æˆ
**èŒè´£**: å¯¹è¯ç®¡ç†ã€æµå¼å“åº”ã€å·¥ä½œæµç¼–æ’
**æŠ€æœ¯**: Go + EINOæ¡†æ¶

```go
// æ•´åˆDifyçš„æµå¼äº‹ä»¶æœºåˆ¶
type StreamEvent struct {
    Event      string                 `json:"event"`
    TaskID     string                 `json:"task_id"`
    Data       map[string]interface{} `json:"data"`
}

func (s *ChatService) ProcessMessage(ctx context.Context, req *ChatRequest) <-chan StreamEvent {
    // ä½¿ç”¨EINOè¿›è¡Œæ¨¡å‹è°ƒç”¨
    chain, _ := eino.NewChain[map[string]any, *Message]().
        AppendChatTemplate(req.Prompt).
        AppendChatModel(s.getModelFromToken(req.Token)).
        Compile(ctx)
        
    // æµå¼å“åº”å¤„ç†
    response := chain.Stream(ctx, req.Variables)
    // å‘é€Difyæ ¼å¼çš„æµå¼äº‹ä»¶...
}
```

#### Memory Service - Mem0AIé›†æˆ
**èŒè´£**: å¯¹è¯è®°å¿†ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€æ™ºèƒ½æ£€ç´¢
**æŠ€æœ¯**: FastAPI + Mem0AI + Qdrant

```python
class MemoryService:
    def __init__(self):
        self.mem0 = Memory(config={
            "vector_store": {"provider": "qdrant"},
            "llm": {"provider": "openai"}
        })
    
    async def enhance_prompt_with_memory(self, user_id: str, message: str) -> str:
        """ä½¿ç”¨è®°å¿†å¢å¼ºæç¤ºè¯"""
        relevant_memories = await self.get_relevant_memories(user_id, message)
        
        enhanced_prompt = f"""
åŸºäºä»¥ä¸‹å†å²è®°å¿†ä¸Šä¸‹æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ï¼š
**ç›¸å…³è®°å¿†**: {memories_context}
**å½“å‰é—®é¢˜**: {message}
"""
        return enhanced_prompt
```

---

## ğŸ”§ å…³é”®æŠ€æœ¯å†³ç­–

### 1. Provider Serviceæ¶æ„è°ƒæ•´

**åŸæ–¹æ¡ˆ**: Go + EINOè´Ÿè´£APIå¯†é’¥ç®¡ç†
**æ–°æ–¹æ¡ˆ**: FastAPI + One-APIæœºåˆ¶è´Ÿè´£å¯†é’¥ç®¡ç†

**è°ƒæ•´åŸå› **:
- One-APIå·²éªŒè¯çš„æˆç†Ÿæ–¹æ¡ˆï¼Œç›´æ¥å€Ÿé‰´Channel/Tokenæœºåˆ¶
- APIå¯†é’¥ç®¡ç†å±äºæ ‡å‡†ä¸šåŠ¡é€»è¾‘ï¼ŒFastAPIæ›´é€‚åˆ
- EINOä¸“æ³¨äºæ¨¡å‹è°ƒç”¨æŠ½è±¡ï¼ŒèŒè´£æ›´æ¸…æ™°

### 2. æµå¼å“åº”æ¶æ„

æ•´åˆDifyçš„äº‹ä»¶é©±åŠ¨è®¾è®¡ï¼Œå®ç°æ ‡å‡†åŒ–çš„æµå¼å“åº”ï¼š

```python
# API Gatewayçš„æµå¼ä»£ç†
@app.get("/api/v1/chat/stream")
async def stream_chat(request: ChatRequest):
    def generate():
        event_stream = chat_service.process_message_stream(request)
        for event in event_stream:
            yield f"data: {json.dumps(event)}\n\n"
    
    return StreamingResponse(generate(), media_type="text/event-stream")
```

### 3. æ•°æ®åº“è®¾è®¡ä¼˜åŒ–

åŸºäºOne-APIå’Œè°ƒç ”å‘ç°ï¼Œä¼˜åŒ–æ•°æ®åº“è®¾è®¡ï¼š

```sql
-- åŸºäºOne-APIçš„Channelè¡¨è®¾è®¡
CREATE TABLE provider_channels (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    type INTEGER NOT NULL,           -- ä¾›åº”å•†ç±»å‹
    key TEXT NOT NULL,               -- åŠ å¯†çš„APIå¯†é’¥
    priority INTEGER DEFAULT 1,      -- ä¼˜å…ˆçº§
    weight INTEGER DEFAULT 1,        -- æƒé‡
    status INTEGER DEFAULT 1,        -- çŠ¶æ€
    quota BIGINT,                    -- é…é¢é™åˆ¶
    used_quota BIGINT DEFAULT 0      -- å·²ä½¿ç”¨é…é¢
);

-- åŸºäºMem0AIçš„è®°å¿†å­˜å‚¨è¡¨
CREATE TABLE conversation_memories (
    id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    memory_content TEXT NOT NULL,
    memory_hash VARCHAR(255) NOT NULL,
    embedding_id VARCHAR(255),
    relevance_score FLOAT,
    memory_type VARCHAR(50) DEFAULT 'conversation'
);
```

---

## âœ… æŠ€æœ¯æ ˆç¡®è®¤

### æ ¸å¿ƒæ¡†æ¶é€‰æ‹©
- **EINOæ¡†æ¶** - Chat Serviceçš„æ¨¡å‹è°ƒç”¨å’Œå·¥ä½œæµç¼–æ’
- **One-APIæœºåˆ¶** - Provider Serviceçš„Channel/Tokenç®¡ç†
- **Mem0AI** - Memory Serviceçš„æ™ºèƒ½è®°å¿†ç®¡ç†
- **Difyäº‹ä»¶æ¨¡å¼** - æµå¼å“åº”çš„äº‹ä»¶é©±åŠ¨æ¶æ„
- **Open-WebUIè®¾è®¡ç†å¿µ** - ç®€åŒ–çš„æƒé™ç®¡ç†å’Œç”¨æˆ·ç•Œé¢

### æŠ€æœ¯æ ˆåˆ†å¸ƒ
- **Frontend**: React + TypeScript + Ant Design X
- **API Gateway**: FastAPI + WebSocket
- **Business Services**: FastAPI + PostgreSQL
- **AI Services**: Go + EINO + æµå¼å¤„ç†
- **Memory Services**: FastAPI + Mem0AI + Qdrant
- **Infrastructure**: PostgreSQL + Redis + Qdrant + MinIO

### æ¶æ„ä¼˜åŠ¿

1. **æŠ€æœ¯å…ˆè¿›æ€§** - æ•´åˆäº”ä¸ªä¼˜ç§€å¼€æºé¡¹ç›®çš„æœ€ä½³å®è·µ
2. **æ¶æ„åˆç†æ€§** - æ¯ä¸ªæœåŠ¡èŒè´£æ¸…æ™°ï¼ŒæŠ€æœ¯é€‰å‹æ°å½“  
3. **å®æ–½å¯è¡Œæ€§** - æœ‰æˆç†Ÿæ¡†æ¶æ”¯æ’‘ï¼Œé™ä½å¼€å‘é£é™©
4. **æ‰©å±•æ€§å¼º** - ä¸ºæœªæ¥å·¥ä½œæµç¼–æ’ç­‰é«˜çº§åŠŸèƒ½å¥ å®šåŸºç¡€

è¿™ä¸ªåŸºäºæ·±åº¦è°ƒç ”çš„æŠ€æœ¯æ¶æ„ï¼Œä¸ºLyss AI Platformæä¾›äº†ä¸€ä¸ªæŠ€æœ¯å…ˆè¿›ã€æ¶æ„åˆç†ã€æ˜“äºå®æ–½çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚