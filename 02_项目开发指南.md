# LYSS AI å¹³å°ï¼šå®Œæ•´é¡¹ç›®å¼€å‘æŒ‡å—

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025å¹´7æœˆ7æ—¥  
**é€‚ç”¨å¯¹è±¡**: å•äººå¼€å‘è€…  

---

## ğŸš€ **é¡¹ç›®æ¦‚è¿°**

æœ¬æŒ‡å—å°†æŒ‡å¯¼æ‚¨ä»é›¶å¼€å§‹æ„å»º LYSS AI å¹³å°ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºä¾›åº”å•†ä½œç”¨åŸŸè®¾è®¡çš„æ™ºèƒ½AIèšåˆå¹³å°ã€‚æ•´ä¸ªé¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼Œç¡®ä¿é«˜æ€§èƒ½ã€ä½æˆæœ¬å’Œæ˜“ç»´æŠ¤ã€‚

### ğŸ“‹ **é¡¹ç›®ç‰¹æ€§**

- âœ… **ä¾›åº”å•†ä½œç”¨åŸŸç®¡ç†**: ä¼˜é›…çš„æƒé™æ§åˆ¶æœºåˆ¶
- âœ… **æ™ºèƒ½è®°å¿†ç³»ç»Ÿ**: åŸºäºMem0çš„ä¸ªæ€§åŒ–å¯¹è¯
- âœ… **æˆæœ¬ä¼˜åŒ–**: å¤šå±‚ç¼“å­˜ + æ™ºèƒ½è®°å¿†å‹ç¼©
- âœ… **ç°ä»£åŒ–ç•Œé¢**: React + Ant Design X
- âœ… **å®Œå…¨è‡ªæ‰˜ç®¡**: æ— å¤–éƒ¨ä¾èµ–

---

## ğŸ“‚ **é¡¹ç›®ç»“æ„**

```
lyss-ai-platform/
â”œâ”€â”€ docker-compose.yml          # Docker ç¼–æ’æ–‡ä»¶
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ backend/                   # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ pyproject.toml         # Poetry ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ poetry.lock
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py           # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ core/             # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py     # åº”ç”¨é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py   # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚   â””â”€â”€ security.py   # å®‰å…¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py       # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ provider.py   # ä¾›åº”å•†æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ conversation.py # å¯¹è¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ api/              # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py   # è®¤è¯ç›¸å…³
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ providers.py # ä¾›åº”å•†ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chat.py   # å¯¹è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ provider_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ memory_service.py
â”‚   â”‚   â”‚   â””â”€â”€ chat_service.py
â”‚   â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ cache.py
â”‚   â”‚       â””â”€â”€ ai_clients.py
â”œâ”€â”€ frontend/                  # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ pnpm-lock.yaml
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ main.tsx
â”‚   â”‚   â”œâ”€â”€ components/       # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProviderManagement/
â”‚   â”‚   â”‚   â””â”€â”€ Chat/
â”‚   â”‚   â”œâ”€â”€ pages/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ProviderPage.tsx
â”‚   â”‚   â”œâ”€â”€ services/        # API æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â””â”€â”€ providers.ts
â”‚   â”‚   â”œâ”€â”€ store/           # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â””â”€â”€ providers.ts
â”‚   â”‚   â””â”€â”€ types/           # ç±»å‹å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ user.ts
â”‚   â”‚       â”œâ”€â”€ provider.ts
â”‚   â”‚       â””â”€â”€ chat.ts
â””â”€â”€ docs/                     # æ–‡æ¡£
    â”œâ”€â”€ api/                  # API æ–‡æ¡£
    â”œâ”€â”€ deployment/           # éƒ¨ç½²æ–‡æ¡£
    â””â”€â”€ development/          # å¼€å‘æ–‡æ¡£
```

---

## ğŸ› ï¸ **å¼€å‘ç¯å¢ƒå‡†å¤‡**

### **1. åŸºç¡€ç¯å¢ƒ**

ç¡®ä¿æ‚¨çš„å¼€å‘ç¯å¢ƒå·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š

```bash
# æ£€æŸ¥ Docker ç‰ˆæœ¬
docker --version
# åº”è¯¥æ˜¾ç¤º Docker version 20.10.0 æˆ–æ›´é«˜ç‰ˆæœ¬

# æ£€æŸ¥ Docker Compose ç‰ˆæœ¬
docker-compose --version
# åº”è¯¥æ˜¾ç¤º Docker Compose version 2.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version
# åº”è¯¥æ˜¾ç¤º v18.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version
# åº”è¯¥æ˜¾ç¤º Python 3.11.0 æˆ–æ›´é«˜ç‰ˆæœ¬
```

### **2. å®‰è£…å¼€å‘å·¥å…·**

```bash
# å®‰è£… Poetry (Python ä¾èµ–ç®¡ç†)
curl -sSL https://install.python-poetry.org | python3 -

# å®‰è£… pnpm (Node.js åŒ…ç®¡ç†å™¨)
npm install -g pnpm

# éªŒè¯å®‰è£…
poetry --version
pnpm --version
```

---

## ğŸ—ï¸ **é¡¹ç›®åˆå§‹åŒ–**

### **æ­¥éª¤1: åˆ›å»ºé¡¹ç›®ç›®å½•**

```bash
# åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•
mkdir lyss-ai-platform
cd lyss-ai-platform

# åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„
mkdir -p backend/app/{core,models,api/v1,services,utils}
mkdir -p frontend/src/{components,pages,services,store,types}
mkdir -p docs/{api,deployment,development}
```

### **æ­¥éª¤2: é…ç½®ç¯å¢ƒå˜é‡**

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# .env æ–‡ä»¶å†…å®¹
# æ•°æ®åº“é…ç½®
POSTGRES_USER=lyss_user
POSTGRES_PASSWORD=your_strong_password_here
POSTGRES_DB=lyss_db
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# Qdrant é…ç½®
QDRANT_HOST=localhost
QDRANT_PORT=6333

# åº”ç”¨é…ç½®
SECRET_KEY=your-secret-key-here-minimum-32-characters
API_V1_STR=/api/v1
PROJECT_NAME=LYSS AI Platform

# å‰ç«¯é…ç½®
VITE_API_URL=http://localhost:8000
VITE_APP_NAME=LYSS AI Platform
```

### **æ­¥éª¤3: Docker åŸºç¡€è®¾æ–½**

åˆ›å»º `docker-compose.yml`ï¼š

```yaml
version: '3.8'

services:
  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:16-alpine
    container_name: lyss_postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - lyss_network

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: lyss_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
    networks:
      - lyss_network

  # Qdrant å‘é‡æ•°æ®åº“
  qdrant:
    image: qdrant/qdrant:v1.10.1
    container_name: lyss_qdrant
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped
    networks:
      - lyss_network

  # åç«¯æœåŠ¡
  backend:
    build: ./backend
    container_name: lyss_backend
    ports:
      - "8000:8000"
    environment:
      - POSTGRES_HOST=postgres
      - REDIS_HOST=redis
      - QDRANT_HOST=qdrant
    env_file:
      - .env
    depends_on:
      - postgres
      - redis
      - qdrant
    volumes:
      - ./backend:/app
    restart: unless-stopped
    networks:
      - lyss_network

  # å‰ç«¯æœåŠ¡
  frontend:
    build: ./frontend
    container_name: lyss_frontend
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://localhost:8000
    depends_on:
      - backend
    volumes:
      - ./frontend:/app
      - /app/node_modules
    restart: unless-stopped
    networks:
      - lyss_network

volumes:
  postgres_data:
  redis_data:
  qdrant_data:

networks:
  lyss_network:
    driver: bridge
```

---

## ğŸ”§ **åç«¯å¼€å‘**

### **æ­¥éª¤1: åˆå§‹åŒ– Poetry é¡¹ç›®**

```bash
cd backend

# åˆå§‹åŒ– Poetry é¡¹ç›®
poetry init --name lyss-ai-platform --version 0.1.0 --description "LYSS AI Platform Backend"

# æ·»åŠ ä¾èµ–
poetry add fastapi uvicorn[standard] sqlalchemy alembic psycopg2-binary redis mem0ai qdrant-client pydantic-settings python-jose[cryptography] passlib[bcrypt] python-multipart

# æ·»åŠ å¼€å‘ä¾èµ–
poetry add --group dev pytest pytest-asyncio black isort mypy
```

### **æ­¥éª¤2: åˆ›å»ºåŸºç¡€é…ç½®**

åˆ›å»º `backend/app/core/config.py`ï¼š

```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    """åº”ç”¨é…ç½®"""
    
    # é¡¹ç›®ä¿¡æ¯
    PROJECT_NAME: str = "LYSS AI Platform"
    VERSION: str = "1.0.0"
    API_V1_STR: str = "/api/v1"
    
    # å®‰å…¨é…ç½®
    SECRET_KEY: str
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    
    # æ•°æ®åº“é…ç½®
    POSTGRES_USER: str
    POSTGRES_PASSWORD: str
    POSTGRES_HOST: str
    POSTGRES_PORT: int = 5432
    POSTGRES_DB: str
    
    @property
    def database_url(self) -> str:
        return f"postgresql://{self.POSTGRES_USER}:{self.POSTGRES_PASSWORD}@{self.POSTGRES_HOST}:{self.POSTGRES_PORT}/{self.POSTGRES_DB}"
    
    # Redis é…ç½®
    REDIS_HOST: str
    REDIS_PORT: int = 6379
    REDIS_DB: int = 0
    
    @property
    def redis_url(self) -> str:
        return f"redis://{self.REDIS_HOST}:{self.REDIS_PORT}/{self.REDIS_DB}"
    
    # Qdrant é…ç½®
    QDRANT_HOST: str
    QDRANT_PORT: int = 6333
    
    # è·¨åŸŸé…ç½®
    CORS_ORIGINS: list[str] = ["http://localhost:3000"]
    
    class Config:
        env_file = ".env"
        case_sensitive = True

# å…¨å±€é…ç½®å®ä¾‹
settings = Settings()
```

### **æ­¥éª¤3: æ•°æ®åº“æ¨¡å‹**

åˆ›å»º `backend/app/models/user.py`ï¼š

```python
from sqlalchemy import Column, Integer, String, Boolean, DateTime, Enum
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.sql import func
from enum import Enum as PyEnum

Base = declarative_base()

class UserRole(str, PyEnum):
    """ç”¨æˆ·è§’è‰²æšä¸¾"""
    ADMIN = "admin"
    USER = "user"

class User(Base):
    """ç”¨æˆ·æ¨¡å‹"""
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(100), unique=True, index=True, nullable=False)
    hashed_password = Column(String(255), nullable=False)
    role = Column(Enum(UserRole), default=UserRole.USER, nullable=False)
    is_active = Column(Boolean, default=True, nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
```

åˆ›å»º `backend/app/models/provider.py`ï¼š

```python
from sqlalchemy import Column, Integer, String, Boolean, DateTime, Enum, ForeignKey, Text, JSON
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.sql import func
from sqlalchemy.orm import relationship
from enum import Enum as PyEnum

Base = declarative_base()

class ProviderScope(str, PyEnum):
    """ä¾›åº”å•†ä½œç”¨åŸŸæšä¸¾"""
    ORGANIZATION = "organization"
    PERSONAL = "personal"

class ProviderType(str, PyEnum):
    """ä¾›åº”å•†ç±»å‹æšä¸¾"""
    OPENAI = "openai"
    ANTHROPIC = "anthropic"
    OLLAMA = "ollama"
    CUSTOM = "custom"

class ProviderConfig(Base):
    """ä¾›åº”å•†é…ç½®æ¨¡å‹"""
    __tablename__ = "provider_configs"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(100), nullable=False)
    provider_type = Column(Enum(ProviderType), nullable=False)
    scope = Column(Enum(ProviderScope), nullable=False)
    created_by = Column(Integer, ForeignKey("users.id"), nullable=False)
    api_key = Column(String(500), nullable=False)  # åŠ å¯†å­˜å‚¨
    api_base_url = Column(String(200), nullable=True)
    config = Column(JSON, default=dict)  # ä¾›åº”å•†ç‰¹å®šé…ç½®
    is_active = Column(Boolean, default=True, nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    # å…³ç³»
    creator = relationship("User", back_populates="created_providers")

class ProviderDistribution(Base):
    """ä¾›åº”å•†åˆ†å‘è®°å½•"""
    __tablename__ = "provider_distributions"
    
    id = Column(Integer, primary_key=True, index=True)
    provider_id = Column(Integer, ForeignKey("provider_configs.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    distributed_by = Column(Integer, ForeignKey("users.id"), nullable=False)
    distributed_at = Column(DateTime(timezone=True), server_default=func.now())
    is_active = Column(Boolean, default=True, nullable=False)
    
    # å…³ç³»
    provider = relationship("ProviderConfig")
    user = relationship("User", foreign_keys=[user_id])
    distributor = relationship("User", foreign_keys=[distributed_by])
```

### **æ­¥éª¤4: ä¸šåŠ¡æœåŠ¡å±‚**

åˆ›å»º `backend/app/services/memory_service.py`ï¼š

```python
from mem0 import Memory
from typing import List, Dict, Any
import json
import logging

logger = logging.getLogger(__name__)

class MemoryService:
    """æ™ºèƒ½è®°å¿†æœåŠ¡"""
    
    def __init__(self, qdrant_host: str = "localhost", qdrant_port: int = 6333):
        """åˆå§‹åŒ–è®°å¿†æœåŠ¡"""
        self.config = {
            "vector_store": {
                "provider": "qdrant",
                "config": {
                    "collection_name": "lyss_memories",
                    "host": qdrant_host,
                    "port": qdrant_port,
                }
            }
        }
        self.memory = Memory(self.config)
    
    async def enhance_conversation(self, user_id: int, messages: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """ä½¿ç”¨æ™ºèƒ½è®°å¿†å¢å¼ºå¯¹è¯"""
        try:
            # 1. æ£€ç´¢ç›¸å…³è®°å¿†
            if not messages:
                return messages
            
            query = messages[-1]["content"]
            relevant_memories = self.memory.search(
                query=query,
                user_id=str(user_id),
                limit=5
            )
            
            # 2. æ„å»ºè®°å¿†ä¸Šä¸‹æ–‡
            memory_context = ""
            if relevant_memories.get("results"):
                memory_context = "ç›¸å…³è®°å¿†:\n" + "\n".join([
                    f"- {memory['memory']}" 
                    for memory in relevant_memories["results"]
                ])
            
            # 3. å¢å¼ºç³»ç»Ÿæç¤º
            enhanced_messages = messages.copy()
            if memory_context:
                system_message = {
                    "role": "system",
                    "content": f"""ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½AIåŠ©æ‰‹ã€‚ä»¥ä¸‹æ˜¯ç”¨æˆ·çš„ç›¸å…³è®°å¿†ï¼š

{memory_context}

è¯·åŸºäºè¿™äº›è®°å¿†æä¾›ä¸ªæ€§åŒ–çš„å›å¤ï¼Œä½†ä¸è¦ç›´æ¥æåŠ"è®°å¿†"è¿™ä¸ªè¯ã€‚"""
                }
                enhanced_messages.insert(0, system_message)
            
            return enhanced_messages
            
        except Exception as e:
            logger.error(f"å¢å¼ºå¯¹è¯å¤±è´¥: {e}")
            return messages
    
    async def store_conversation(self, user_id: int, messages: List[Dict[str, Any]]):
        """å­˜å‚¨å¯¹è¯åˆ°è®°å¿†ä¸­"""
        try:
            if len(messages) < 2:
                return
            
            # åªå­˜å‚¨æœ€è¿‘çš„ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›å¤
            conversation_to_store = messages[-2:]
            
            self.memory.add(
                messages=conversation_to_store,
                user_id=str(user_id)
            )
            
            logger.info(f"æˆåŠŸå­˜å‚¨ç”¨æˆ· {user_id} çš„å¯¹è¯è®°å¿†")
            
        except Exception as e:
            logger.error(f"å­˜å‚¨å¯¹è¯è®°å¿†å¤±è´¥: {e}")
    
    async def get_user_memories(self, user_id: int, limit: int = 10) -> List[Dict[str, Any]]:
        """è·å–ç”¨æˆ·çš„è®°å¿†åˆ—è¡¨"""
        try:
            memories = self.memory.get_all(user_id=str(user_id), limit=limit)
            return memories.get("results", [])
        except Exception as e:
            logger.error(f"è·å–ç”¨æˆ·è®°å¿†å¤±è´¥: {e}")
            return []
    
    async def delete_user_memories(self, user_id: int):
        """åˆ é™¤ç”¨æˆ·çš„æ‰€æœ‰è®°å¿†"""
        try:
            self.memory.delete_all(user_id=str(user_id))
            logger.info(f"æˆåŠŸåˆ é™¤ç”¨æˆ· {user_id} çš„æ‰€æœ‰è®°å¿†")
        except Exception as e:
            logger.error(f"åˆ é™¤ç”¨æˆ·è®°å¿†å¤±è´¥: {e}")
```

### **æ­¥éª¤5: API è·¯ç”±**

åˆ›å»º `backend/app/api/v1/chat.py`ï¼š

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List, Dict, Any
from pydantic import BaseModel

from app.core.database import get_db
from app.services.chat_service import ChatService
from app.services.auth_service import get_current_user
from app.models.user import User

router = APIRouter()
chat_service = ChatService()

class ChatMessage(BaseModel):
    """èŠå¤©æ¶ˆæ¯æ¨¡å‹"""
    role: str
    content: str

class ChatRequest(BaseModel):
    """èŠå¤©è¯·æ±‚æ¨¡å‹"""
    provider_id: int
    messages: List[ChatMessage]

class ChatResponse(BaseModel):
    """èŠå¤©å“åº”æ¨¡å‹"""
    message: ChatMessage
    provider_name: str
    cached: bool = False

@router.post("/chat", response_model=ChatResponse)
async def chat(
    request: ChatRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """å¤„ç†èŠå¤©è¯·æ±‚"""
    try:
        # è½¬æ¢æ¶ˆæ¯æ ¼å¼
        messages = [msg.dict() for msg in request.messages]
        
        # è°ƒç”¨èŠå¤©æœåŠ¡
        response = await chat_service.process_chat(
            user_id=current_user.id,
            provider_id=request.provider_id,
            messages=messages,
            db=db
        )
        
        return ChatResponse(
            message=ChatMessage(
                role=response["role"],
                content=response["content"]
            ),
            provider_name=response["provider_name"],
            cached=response.get("cached", False)
        )
        
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"èŠå¤©å¤„ç†å¤±è´¥: {str(e)}"
        )
```

### **æ­¥éª¤6: ä¸»åº”ç”¨æ–‡ä»¶**

åˆ›å»º `backend/app/main.py`ï¼š

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager

from app.core.config import settings
from app.core.database import create_tables
from app.api.v1 import auth, providers, chat

@asynccontextmanager
async def lifespan(app: FastAPI):
    # å¯åŠ¨æ—¶åˆ›å»ºæ•°æ®åº“è¡¨
    await create_tables()
    yield
    # å…³é—­æ—¶çš„æ¸…ç†å·¥ä½œ

app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    description="LYSS AI Platform - æ™ºèƒ½AIèšåˆå¹³å°",
    lifespan=lifespan
)

# é…ç½®CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# æ³¨å†Œè·¯ç”±
app.include_router(auth.router, prefix=f"{settings.API_V1_STR}/auth", tags=["è®¤è¯"])
app.include_router(providers.router, prefix=f"{settings.API_V1_STR}/providers", tags=["ä¾›åº”å•†"])
app.include_router(chat.router, prefix=f"{settings.API_V1_STR}/chat", tags=["å¯¹è¯"])

@app.get("/")
async def root():
    return {"message": "LYSS AI Platform API", "version": settings.VERSION}

@app.get("/health")
async def health_check():
    return {"status": "healthy"}
```

### **æ­¥éª¤7: Dockerfile**

åˆ›å»º `backend/Dockerfile`ï¼š

```dockerfile
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£… Poetry
RUN pip install poetry

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY pyproject.toml poetry.lock ./

# é…ç½® Poetry
RUN poetry config virtualenvs.create false

# å®‰è£…ä¾èµ–
RUN poetry install --no-dev

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
```

---

## ğŸ¨ **å‰ç«¯å¼€å‘**

### **æ­¥éª¤1: åˆå§‹åŒ–å‰ç«¯é¡¹ç›®**

```bash
cd frontend

# åˆå§‹åŒ–é¡¹ç›®
pnpm create vite . --template react-ts

# å®‰è£…ä¾èµ–
pnpm install

# å®‰è£…é¢å¤–ä¾èµ–
pnpm add antd @ant-design/x zustand @tanstack/react-query axios react-router-dom
pnpm add -D @types/node
```

### **æ­¥éª¤2: é…ç½® Vite**

åˆ›å»º `frontend/vite.config.ts`ï¼š

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    host: true,
    port: 3000,
  },
})
```

### **æ­¥éª¤3: ç±»å‹å®šä¹‰**

åˆ›å»º `frontend/src/types/provider.ts`ï¼š

```typescript
export enum ProviderScope {
  ORGANIZATION = 'organization',
  PERSONAL = 'personal',
}

export enum ProviderType {
  OPENAI = 'openai',
  ANTHROPIC = 'anthropic',
  OLLAMA = 'ollama',
  CUSTOM = 'custom',
}

export interface ProviderConfig {
  id: number;
  name: string;
  provider_type: ProviderType;
  scope: ProviderScope;
  created_by: number;
  api_base_url?: string;
  config: Record<string, any>;
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

export interface CreateProviderRequest {
  name: string;
  provider_type: ProviderType;
  scope: ProviderScope;
  api_key: string;
  api_base_url?: string;
  config?: Record<string, any>;
}
```

### **æ­¥éª¤4: API æœåŠ¡**

åˆ›å»º `frontend/src/services/api.ts`ï¼š

```typescript
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';

export const api = axios.create({
  baseURL: `${API_BASE_URL}/api/v1`,
  timeout: 10000,
});

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // æ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ
      localStorage.removeItem('access_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### **æ­¥éª¤5: çŠ¶æ€ç®¡ç†**

åˆ›å»º `frontend/src/store/auth.ts`ï¼š

```typescript
import { create } from 'zustand';
import { User } from '@/types/user';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  setAuth: (user: User, token: string) => void;
  clearAuth: () => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: localStorage.getItem('access_token'),
  isAuthenticated: !!localStorage.getItem('access_token'),
  setAuth: (user, token) => {
    localStorage.setItem('access_token', token);
    set({ user, token, isAuthenticated: true });
  },
  clearAuth: () => {
    localStorage.removeItem('access_token');
    set({ user: null, token: null, isAuthenticated: false });
  },
}));
```

### **æ­¥éª¤6: å‰ç«¯ç»„ä»¶**

åˆ›å»º `frontend/src/components/Chat/ChatInterface.tsx`ï¼š

```typescript
import React, { useState, useEffect } from 'react';
import { Card, List, Avatar, Space, Empty, Button, Select, notification } from 'antd';
import { Sender, Bubble, useXChat } from '@ant-design/x';
import { useQuery } from '@tanstack/react-query';
import { ProviderConfig } from '@/types/provider';
import { useAuthStore } from '@/store/auth';
import { api } from '@/services/api';

const { Option } = Select;

interface ChatInterfaceProps {
  onProviderSelect?: (provider: ProviderConfig) => void;
}

export const ChatInterface: React.FC<ChatInterfaceProps> = ({ onProviderSelect }) => {
  const [selectedProvider, setSelectedProvider] = useState<ProviderConfig | null>(null);
  const { user } = useAuthStore();

  // è·å–å¯ç”¨ä¾›åº”å•†
  const { data: providers, isLoading } = useQuery({
    queryKey: ['available-providers'],
    queryFn: async () => {
      const response = await api.get('/providers/available');
      return response.data;
    },
  });

  // èŠå¤©çŠ¶æ€ç®¡ç†
  const { messages, setMessages, isLoading: chatLoading } = useXChat();

  // å‘é€æ¶ˆæ¯
  const handleSendMessage = async (content: string) => {
    if (!selectedProvider) {
      notification.error({
        message: 'è¯·é€‰æ‹©AIä¾›åº”å•†',
        description: 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªAIä¾›åº”å•†å†å¼€å§‹å¯¹è¯',
      });
      return;
    }

    const userMessage = {
      id: Date.now().toString(),
      role: 'user' as const,
      content,
    };

    setMessages([...messages, userMessage]);

    try {
      const response = await api.post('/chat/chat', {
        provider_id: selectedProvider.id,
        messages: [...messages, userMessage],
      });

      const aiMessage = {
        id: (Date.now() + 1).toString(),
        role: 'assistant' as const,
        content: response.data.message.content,
      };

      setMessages([...messages, userMessage, aiMessage]);
    } catch (error) {
      notification.error({
        message: 'å¯¹è¯å¤±è´¥',
        description: 'è¯·ç¨åé‡è¯•',
      });
    }
  };

  return (
    <div style={{ display: 'flex', height: '100vh' }}>
      {/* ä¾§è¾¹æ ï¼šä¾›åº”å•†é€‰æ‹© */}
      <div style={{ width: 300, borderRight: '1px solid #f0f0f0' }}>
        <Card title="é€‰æ‹©AIä¾›åº”å•†" size="small">
          {isLoading ? (
            <div>åŠ è½½ä¸­...</div>
          ) : (
            <List
              dataSource={providers}
              renderItem={(provider: ProviderConfig) => (
                <List.Item
                  onClick={() => {
                    setSelectedProvider(provider);
                    onProviderSelect?.(provider);
                  }}
                  className={selectedProvider?.id === provider.id ? 'selected' : ''}
                  style={{ 
                    cursor: 'pointer',
                    backgroundColor: selectedProvider?.id === provider.id ? '#f0f0f0' : 'transparent'
                  }}
                >
                  <Space>
                    <Avatar 
                      size="small" 
                      style={{ 
                        backgroundColor: provider.scope === 'organization' ? '#52c41a' : '#fa8c16' 
                      }}
                    >
                      {provider.name[0]}
                    </Avatar>
                    <div>
                      <div>{provider.name}</div>
                      <div style={{ fontSize: 12, color: '#666' }}>
                        {provider.scope === 'organization' ? 'ç»„ç»‡' : 'ä¸ªäºº'}
                      </div>
                    </div>
                  </Space>
                </List.Item>
              )}
            />
          )}
        </Card>
      </div>

      {/* ä¸»èŠå¤©åŒºåŸŸ */}
      <div style={{ flex: 1 }}>
        {selectedProvider ? (
          <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
            {/* èŠå¤©æ¶ˆæ¯åŒºåŸŸ */}
            <div style={{ flex: 1, overflow: 'auto', padding: '16px' }}>
              {messages.map((msg) => (
                <Bubble
                  key={msg.id}
                  content={msg.content}
                  placement={msg.role === 'user' ? 'right' : 'left'}
                  style={{ margin: '8px 0' }}
                />
              ))}
            </div>

            {/* è¾“å…¥åŒºåŸŸ */}
            <div style={{ borderTop: '1px solid #f0f0f0', padding: '16px' }}>
              <Sender
                placeholder={`ä¸ ${selectedProvider.name} å¯¹è¯...`}
                onSend={handleSendMessage}
                loading={chatLoading}
              />
            </div>
          </div>
        ) : (
          <div style={{ 
            height: '100%', 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'center' 
          }}>
            <Empty description="è¯·é€‰æ‹©ä¸€ä¸ªAIä¾›åº”å•†å¼€å§‹å¯¹è¯" />
          </div>
        )}
      </div>
    </div>
  );
};
```

### **æ­¥éª¤7: å‰ç«¯ Dockerfile**

åˆ›å»º `frontend/Dockerfile`ï¼š

```dockerfile
FROM node:18-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£… pnpm
RUN npm install -g pnpm

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./

# å®‰è£…ä¾èµ–
RUN pnpm install

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨å‘½ä»¤
CMD ["pnpm", "dev", "--host"]
```

---

## ğŸš€ **éƒ¨ç½²å’Œè¿è¡Œ**

### **æ­¥éª¤1: å¯åŠ¨å¼€å‘ç¯å¢ƒ**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd lyss-ai-platform

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend
```

### **æ­¥éª¤2: æ•°æ®åº“åˆå§‹åŒ–**

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec backend bash

# åˆ›å»ºæ•°æ®åº“è¿ç§»
alembic init alembic
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
python -c "
from app.core.database import SessionLocal
from app.models.user import User, UserRole
from app.core.security import get_password_hash

db = SessionLocal()
admin_user = User(
    username='admin',
    email='admin@example.com',
    hashed_password=get_password_hash('admin123'),
    role=UserRole.ADMIN
)
db.add(admin_user)
db.commit()
print('ç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºæˆåŠŸ')
"
```

### **æ­¥éª¤3: è®¿é—®åº”ç”¨**

- **å‰ç«¯ç•Œé¢**: http://localhost:3000
- **åç«¯API**: http://localhost:8000
- **APIæ–‡æ¡£**: http://localhost:8000/docs

### **æ­¥éª¤4: åŠŸèƒ½æµ‹è¯•**

1. **ç™»å½•ç³»ç»Ÿ**: ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•
2. **åˆ›å»ºä¾›åº”å•†**: æ·»åŠ OpenAIã€Anthropicç­‰ä¾›åº”å•†é…ç½®
3. **æµ‹è¯•å¯¹è¯**: é€‰æ‹©ä¾›åº”å•†å¼€å§‹å¯¹è¯ï¼ŒéªŒè¯æ™ºèƒ½è®°å¿†åŠŸèƒ½
4. **æƒé™æµ‹è¯•**: åˆ›å»ºæ™®é€šç”¨æˆ·ï¼Œæµ‹è¯•æƒé™æ§åˆ¶

---

## ğŸ“ **åç»­å¼€å‘è®¡åˆ’**

### **ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€åŠŸèƒ½å®Œå–„**
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… ä¾›åº”å•†é…ç½®ç®¡ç†
- âœ… åŸºç¡€å¯¹è¯åŠŸèƒ½
- âœ… æ™ºèƒ½è®°å¿†é›†æˆ

### **ç¬¬äºŒé˜¶æ®µ: é«˜çº§åŠŸèƒ½**
- ğŸ”„ å¯¹è¯å†å²ç®¡ç†
- ğŸ”„ æ–‡ä»¶ä¸Šä¼ å’Œå¤„ç†
- ğŸ”„ æ’ä»¶ç³»ç»Ÿ
- ğŸ”„ ä½¿ç”¨ç»Ÿè®¡å’Œç›‘æ§

### **ç¬¬ä¸‰é˜¶æ®µ: ä¼ä¸šçº§åŠŸèƒ½**
- ğŸ“‹ é«˜çº§RBAC
- ğŸ“‹ å®¡è®¡æ—¥å¿—
- ğŸ“‹ æ•°æ®å¤‡ä»½
- ğŸ“‹ æ€§èƒ½ä¼˜åŒ–

---

## ğŸ”§ **å¸¸è§é—®é¢˜è§£å†³**

### **Docker ç›¸å…³é—®é¢˜**

```bash
# é‡æ–°æ„å»ºé•œåƒ
docker-compose build --no-cache

# æ¸…ç†æ‰€æœ‰å®¹å™¨å’Œç½‘ç»œ
docker-compose down -v
docker system prune -a

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs [service_name]
```

### **æ•°æ®åº“é—®é¢˜**

```bash
# é‡ç½®æ•°æ®åº“
docker-compose exec postgres psql -U lyss_user -d lyss_db -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"

# é‡æ–°è¿è¡Œè¿ç§»
docker-compose exec backend alembic upgrade head
```

### **å‰ç«¯é—®é¢˜**

```bash
# æ¸…ç† node_modules
docker-compose exec frontend rm -rf node_modules
docker-compose exec frontend pnpm install

# é‡æ–°å¯åŠ¨å‰ç«¯æœåŠ¡
docker-compose restart frontend
```

---

æ­å–œï¼æ‚¨å·²ç»å®Œæˆäº† LYSS AI å¹³å°çš„å®Œæ•´å¼€å‘æŒ‡å—ã€‚è¿™ä¸ªæŒ‡å—æä¾›äº†ä»é¡¹ç›®åˆå§‹åŒ–åˆ°éƒ¨ç½²ä¸Šçº¿çš„å®Œæ•´æµç¨‹ï¼Œè®©æ‚¨èƒ½å¤Ÿå¿«é€Ÿæ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„AIèšåˆå¹³å°ã€‚

è®°ä½ï¼Œå¼€å‘æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ï¼Œå»ºè®®æ‚¨å…ˆå®ç°åŸºç¡€åŠŸèƒ½ï¼Œç„¶åæ ¹æ®å®é™…éœ€æ±‚é€æ­¥æ·»åŠ æ›´å¤šåŠŸèƒ½ã€‚ç¥æ‚¨å¼€å‘æ„‰å¿«ï¼