# ================================================================
# Lyss Provider Service - 环境变量配置模板
# 
# 复制此文件为 .env 并填入实际值
# 不要提交包含真实密钥的 .env 文件到版本控制系统
#
# Author: Lyss AI Team
# Created: 2025-01-22
# Modified: 2025-01-22
# ================================================================

# ================================================================
# 基础配置
# ================================================================

# 应用环境 (development, testing, production)
ENVIRONMENT=development

# 服务名称和版本
SERVICE_NAME=lyss-provider-service
SERVICE_VERSION=1.0.0

# 服务监听配置
HOST=0.0.0.0
PORT=8003

# 调试模式 (development环境建议启用)
DEBUG=true

# ================================================================
# 数据库配置
# ================================================================

# PostgreSQL主数据库连接
DATABASE_URL=postgresql://lyss_user:lyss123@localhost:5433/lyss_db
DATABASE_HOST=localhost
DATABASE_PORT=5433
DATABASE_USERNAME=lyss_user
DATABASE_PASSWORD=lyss123
DATABASE_NAME=lyss_db

# 数据库连接池配置
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30
DATABASE_ECHO=false

# 数据库SSL配置 (生产环境建议启用)
DATABASE_SSL_MODE=prefer

# ================================================================
# Redis配置
# ================================================================

# Redis连接配置
REDIS_URL=redis://localhost:6380/2
REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_DB=2
REDIS_PASSWORD=

# Redis连接池配置
REDIS_POOL_SIZE=20
REDIS_MAX_CONNECTIONS=50

# Redis键前缀（避免键冲突）
REDIS_KEY_PREFIX=lyss:provider:

# ================================================================
# JWT和安全配置
# ================================================================

# JWT密钥 (生产环境必须使用强密钥)
JWT_SECRET_KEY=your-super-secret-jwt-key-change-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=1440

# API密钥加密配置
ENCRYPTION_KEY=your-32-byte-encryption-key-for-api-keys
ENCRYPTION_ALGORITHM=AES-256-GCM

# CORS配置
CORS_ORIGINS=http://localhost:3000,https://localhost:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=*

# ================================================================
# 速率限制配置
# ================================================================

# 基础速率限制 (请求/分钟)
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_BURST_SIZE=100

# 基于IP的限制 (未认证请求)
RATE_LIMIT_IP_REQUESTS_PER_MINUTE=60
RATE_LIMIT_IP_BURST_SIZE=10

# 基于用户的限制 (已认证请求)
RATE_LIMIT_USER_REQUESTS_PER_MINUTE=200
RATE_LIMIT_USER_BURST_SIZE=50

# ================================================================
# 日志配置
# ================================================================

# 日志级别 (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# 日志格式 (json, text)
LOG_FORMAT=json

# 日志文件配置
LOG_FILE_ENABLED=true
LOG_FILE_PATH=logs/provider-service.log
LOG_FILE_MAX_SIZE=100MB
LOG_FILE_BACKUP_COUNT=7

# 结构化日志配置
LOG_REQUEST_ID_HEADER=X-Request-ID
LOG_INCLUDE_REQUEST_BODY=false
LOG_INCLUDE_RESPONSE_BODY=false

# ================================================================
# Provider配置
# ================================================================

# 默认Provider设置
DEFAULT_REQUEST_TIMEOUT=30
DEFAULT_MAX_RETRIES=3
DEFAULT_RETRY_DELAY=1

# 健康检查配置
HEALTH_CHECK_INTERVAL=300
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_MAX_FAILURES=3

# ================================================================
# Channel配置
# ================================================================

# 负载均衡配置
LOAD_BALANCER_ALGORITHM=weighted_random
LOAD_BALANCER_HEALTH_CHECK_ENABLED=true

# 故障转移配置
FAILOVER_ENABLED=true
FAILOVER_MAX_RETRIES=2

# ================================================================
# 配额管理配置
# ================================================================

# 默认配额限制
DEFAULT_DAILY_REQUEST_LIMIT=10000
DEFAULT_DAILY_TOKEN_LIMIT=1000000
DEFAULT_MONTHLY_REQUEST_LIMIT=300000
DEFAULT_MONTHLY_TOKEN_LIMIT=30000000

# 配额重置配置
QUOTA_RESET_TIME=00:00:00
QUOTA_WARNING_THRESHOLD=0.8

# ================================================================
# 监控和指标配置
# ================================================================

# Prometheus指标配置
METRICS_ENABLED=true
METRICS_PATH=/metrics
METRICS_PORT=9090

# 健康检查端点
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_DETAILED_PATH=/health/detailed

# OpenTelemetry配置 (可选)
OTEL_ENABLED=false
OTEL_SERVICE_NAME=lyss-provider-service
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# ================================================================
# 第三方服务配置
# ================================================================

# OpenAI配置
OPENAI_DEFAULT_BASE_URL=https://api.openai.com/v1
OPENAI_DEFAULT_TIMEOUT=30
OPENAI_DEFAULT_MAX_RETRIES=3

# Anthropic配置
ANTHROPIC_DEFAULT_BASE_URL=https://api.anthropic.com
ANTHROPIC_DEFAULT_TIMEOUT=30
ANTHROPIC_DEFAULT_MAX_RETRIES=3

# Google AI配置
GOOGLE_DEFAULT_BASE_URL=https://generativelanguage.googleapis.com/v1beta
GOOGLE_DEFAULT_TIMEOUT=30
GOOGLE_DEFAULT_MAX_RETRIES=3

# DeepSeek配置
DEEPSEEK_DEFAULT_BASE_URL=https://api.deepseek.com
DEEPSEEK_DEFAULT_TIMEOUT=30
DEEPSEEK_DEFAULT_MAX_RETRIES=3

# ================================================================
# 缓存配置
# ================================================================

# Provider配置缓存
CACHE_PROVIDER_CONFIG_TTL=3600
CACHE_CHANNEL_CONFIG_TTL=1800
CACHE_HEALTH_STATUS_TTL=300

# 响应缓存配置 (可选)
RESPONSE_CACHE_ENABLED=false
RESPONSE_CACHE_TTL=300
RESPONSE_CACHE_MAX_SIZE=1000

# ================================================================
# 开发和测试配置
# ================================================================

# 开发模式配置
DEV_RELOAD=true
DEV_ACCESS_LOG=true
DEV_MOCK_PROVIDERS=false

# 测试配置
TEST_DATABASE_URL=postgresql://lyss_user:lyss123@localhost:5433/lyss_test_db
TEST_REDIS_URL=redis://localhost:6380/3

# ================================================================
# 生产环境专用配置
# ================================================================

# 当 ENVIRONMENT=production 时的特殊配置

# 生产数据库配置
# DATABASE_URL=postgresql://prod_user:secure_password@prod-host:5432/lyss_prod_db
# DATABASE_SSL_MODE=require

# 生产Redis配置
# REDIS_URL=redis://prod-redis:6379/0
# REDIS_PASSWORD=secure_redis_password

# 生产安全配置
# JWT_SECRET_KEY=very-secure-jwt-key-with-at-least-256-bits
# ENCRYPTION_KEY=very-secure-32-byte-encryption-key

# 生产日志配置
# LOG_LEVEL=WARNING
# LOG_FILE_ENABLED=true
# LOG_FILE_PATH=/var/log/lyss/provider-service.log

# 生产监控配置
# METRICS_ENABLED=true
# OTEL_ENABLED=true
# OTEL_EXPORTER_OTLP_ENDPOINT=https://your-observability-platform

# ================================================================
# Docker和容器化配置
# ================================================================

# Docker内部网络配置
DOCKER_INTERNAL_HOST=0.0.0.0
DOCKER_DATABASE_HOST=postgres
DOCKER_REDIS_HOST=redis

# Kubernetes配置 (可选)
K8S_NAMESPACE=lyss-platform
K8S_SERVICE_ACCOUNT=lyss-provider-service

# ================================================================
# API网关集成配置
# ================================================================

# API Gateway配置
API_GATEWAY_URL=http://localhost:8000
API_GATEWAY_HEALTH_CHECK_PATH=/api/v1/health

# 服务发现配置
SERVICE_DISCOVERY_ENABLED=false
SERVICE_REGISTRY_URL=http://localhost:8500

# ================================================================
# 注意事项
# ================================================================

# 1. 生产环境安全提醒:
#    - 使用强密码和密钥
#    - 启用SSL/TLS连接
#    - 限制网络访问
#    - 定期轮换密钥

# 2. 性能优化建议:
#    - 根据实际负载调整连接池大小
#    - 监控Redis内存使用情况
#    - 定期清理旧日志数据

# 3. 监控和告警:
#    - 监控服务健康状态
#    - 设置资源使用告警
#    - 监控错误率和响应时间

# 4. 备份和恢复:
#    - 定期备份数据库
#    - 测试恢复流程
#    - 保存配置文件备份