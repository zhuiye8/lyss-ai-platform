# 📋 下次会话开发指南

## 🎯 会话目标概述

**欢迎继续Lyss AI Platform开发！**

你是接手开发的Claude，本指南将帮助你快速了解当前项目状态，明确下一步开发重点，并提供详细的技术指导。

**当前项目状态**: 架构统一已完成，3个核心服务中2个已完成，1个85%完成  
**下次重点任务**: 完成User Service剩余功能 + 开始Chat Service开发  
**开发模式**: 统一数据库 + 混合部署（数据库Docker + 服务本地启动）  

---

## 📚 必读文档优先级

### **🔥 立即必读 (了解当前状态)**

1. **项目状态报告**
   ```
   📖 🎯 开发进度报告 - 架构统一完成.md
   📖 🚀 开发进度报告 - Auth服务模块.md  
   📖 🎯 开发进度报告 - Provider服务模块.md
   ```
   **阅读目的**: 了解已完成的工作、技术成果和当前进度

2. **项目配置和架构**
   ```
   📖 CLAUDE.md (项目核心说明)
   📖 refactor/architecture/database-design.md
   📖 docker-compose.yml
   ```
   **阅读目的**: 理解统一数据库架构和混合部署模式

### **⚡ 开发前必读 (技术指导)**

3. **开发指南和规范**
   ```
   📖 refactor/development-guide.md
   📖 refactor/standards/coding-standards/python-fastapi.md
   📖 refactor/standards/coding-standards/go-standards.md
   ```

4. **服务架构设计**
   ```
   📖 refactor/architecture/services/user-service.md
   📖 refactor/architecture/services/chat-service.md
   📖 refactor/tech-knowledge/eino-framework.md
   ```

---

## 🎯 下次会话核心任务

### **优先级1: 完成User Service剩余15% 🔥**

**当前状态**: 85%完成，核心架构和用户管理功能已完成  
**剩余任务**:
- 用户画像分析器实现
- 用户活动追踪系统
- 用户关系管理模块
- API路由和中间件完善
- 完整测试覆盖

**开发指导**:
```bash
# 1. 先检查当前User Service状态
cd user-service/
ls -la  # 查看目录结构
cat requirements.txt  # 确认依赖

# 2. 查看现有代码结构
find . -name "*.py" | head -10
cat user_service/main.py  # 了解当前实现

# 3. 运行测试了解当前功能
pytest tests/ -v

# 4. 启动服务验证基础功能
uvicorn user_service.main:app --reload --port 8002
```

### **优先级2: 开始Chat Service开发 🚀**

**技术栈**: Go + EINO框架 + WebSocket  
**关键技术点**: 
- EINO v0.3.52最新API (已通过Context7调研验证)
- 与Provider Service集成调用多供应商模型
- 实时WebSocket流式响应
- 对话上下文管理

**开发指导**:
```bash
# 1. 创建Chat Service基础结构
mkdir -p chat-service/{cmd/server,internal/{handlers,services,models},pkg}

# 2. 初始化Go模块
cd chat-service/
go mod init chat-service
go mod tidy

# 3. 基于EINO框架文档开始开发
# 参考: refactor/tech-knowledge/eino-framework.md
```

### **优先级3: 集成测试和优化 ⚡**

**测试重点**:
- Auth Service + User Service + Provider Service三服务联调
- API Gateway路由和代理功能验证
- 数据库连接和事务一致性测试

---

## 🗄️ 当前架构关键信息

### **数据库架构 (重要变更！)**
- **统一数据库**: 所有服务共享PostgreSQL数据库`lyss_db`
- **表前缀隔离**: `auth_*`, `provider_*`, `chat_*`, `memory_*`, `users`等
- **SQL文件**: 统一存放在`/sql/`目录，自动初始化
- **连接配置**: `localhost:5433`, 用户`lyss`, 密码`test`

### **服务端口分配**
```bash
3000  # Frontend (React开发服务器)
8000  # API Gateway (统一入口)
8001  # Auth Service
8002  # User Service  
8003  # Provider Service
8004  # Chat Service (待开发)
8005  # Memory Service (待开发)

# Docker基础设施
5433  # PostgreSQL
6380  # Redis
6333  # Qdrant向量数据库
9000  # MinIO对象存储
```

### **环境启动顺序**
```bash
# 1. 启动基础设施 (Docker)
docker-compose up -d postgres redis qdrant minio
sleep 15

# 2. 启动微服务 (本地)
# Auth Service (已完成)
cd auth-service && source venv/bin/activate && uvicorn auth_service.main:app --reload --port 8001

# Provider Service (已完成) 
cd provider-service && source venv/bin/activate && uvicorn provider_service.main:app --reload --port 8003

# User Service (85%完成，需要完善)
cd user-service && source venv/bin/activate && uvicorn user_service.main:app --reload --port 8002

# 3. 启动API Gateway
cd backend && source venv/bin/activate && uvicorn api_gateway.main:app --reload --port 8000
```

---

## ⚠️ 重要注意事项

### **开发规范要求**
1. **全程中文注释**: 所有代码注释必须使用中文
2. **统一命名规范**: 服务目录使用短横线格式 (`auth-service/`)
3. **数据库操作**: 必须包含`tenant_id`条件进行多租户隔离
4. **错误处理**: 使用统一的错误响应格式
5. **测试覆盖**: 核心功能必须有单元测试

### **架构原则坚持**
1. **统一数据库**: 不要创建独立数据库，使用表前缀隔离
2. **混合部署**: 基础设施Docker，微服务本地启动调试
3. **API优先**: 服务间通过REST API通信
4. **无状态设计**: 所有服务支持水平扩展

### **技术栈版本锁定**
- Python: 3.11+
- Go: 1.21+
- Node.js: 18+
- FastAPI: 最新稳定版
- EINO: v0.3.52 (已验证)
- Ant Design X: 最新版本

---

## 🚀 快速开始检查清单

### **启动前检查**
```bash
# 1. 验证Docker基础设施
docker-compose ps
curl http://localhost:5433  # PostgreSQL
redis-cli -p 6380 ping     # Redis

# 2. 验证已完成服务
curl http://localhost:8001/health  # Auth Service
curl http://localhost:8003/health  # Provider Service

# 3. 检查User Service状态  
cd user-service/
ls -la user_service/
cat user_service/main.py

# 4. 查看数据库表结构
psql -h localhost -p 5433 -U lyss -d lyss_db -c "\dt"
```

### **开发环境准备**
```bash
# Python虚拟环境 (各服务独立)
cd auth-service && python -m venv venv && source venv/bin/activate && pip install -r requirements.txt
cd user-service && python -m venv venv && source venv/bin/activate && pip install -r requirements.txt
cd provider-service && python -m venv venv && source venv/bin/activate && pip install -r requirements.txt

# Go环境 (Chat Service)
go version  # 确认1.21+
```

---

## 🎯 成功标准和里程碑

### **User Service完成标准**
- [ ] 用户画像分析器API实现
- [ ] 用户活动追踪功能完整
- [ ] 用户关系管理模块可用
- [ ] API路由和中间件完善
- [ ] 单元测试覆盖率>80%
- [ ] 与Auth Service集成测试通过

### **Chat Service第一阶段目标**
- [ ] EINO框架成功集成
- [ ] 基础WebSocket连接建立
- [ ] 与Provider Service模型调用集成
- [ ] 简单对话流程可用
- [ ] 数据库表结构创建

### **整体集成验证**
- [ ] 三大服务(Auth/User/Provider)联调成功
- [ ] API Gateway路由代理正常
- [ ] 前端登录和基础功能正常
- [ ] 数据库事务和一致性验证

---

## 🔧 常见问题和解决方案

### **数据库连接问题**
```bash
# 检查PostgreSQL状态
docker-compose logs postgres

# 测试连接
psql -h localhost -p 5433 -U lyss -d lyss_db -c "SELECT version();"

# 重新初始化数据库
docker-compose down -v
docker-compose up -d postgres
```

### **服务启动失败**
```bash
# 检查端口占用
lsof -i :8001  # Auth Service
lsof -i :8002  # User Service

# 查看服务日志
tail -f logs/服务名.log

# 检查依赖安装
pip install -r requirements.txt
```

### **EINO框架集成问题**
```bash
# 参考已验证的版本
cat refactor/tech-knowledge/version-locks.md

# 查看EINO集成文档
cat refactor/tech-knowledge/eino-framework.md
```

---

## 🎉 开发信心指数

**架构基础**: ✅ 非常稳固 - 统一数据库和服务架构已验证  
**技术栈**: ✅ 成熟可靠 - 基于成功案例和Context7调研  
**代码质量**: ✅ 企业级标准 - Auth和Provider服务已达生产水准  
**开发效率**: 🚀 预期很高 - 清晰的架构和完善的文档支持  

**你可以充满信心地开始下一阶段的开发工作！项目基础非常扎实，技术方案经过验证，成功概率很高！**

---

## 📞 开发过程建议

1. **先理解再动手**: 充分阅读现有代码和文档再开始开发
2. **小步快跑**: 优先完成User Service剩余功能，验证集成
3. **测试驱动**: 每个功能开发完成后立即编写测试
4. **持续验证**: 定期运行集成测试确保系统稳定性
5. **文档同步**: 重要功能完成后及时更新文档

**祝开发顺利！有任何问题可以参考已完成的Auth和Provider服务作为参考模板。** 🚀