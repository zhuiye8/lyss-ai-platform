# =====================================================
# Lyss Provider Service 环境变量配置模板
# 复制此文件为 .env 并根据实际环境修改配置值
# =====================================================

# 应用基础配置
APP_NAME=lyss-provider-service
APP_VERSION=1.0.0
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# 服务端口配置
PROVIDER_SERVICE_PORT=8003
PROVIDER_SERVICE_HOST=0.0.0.0

# 数据库配置
PROVIDER_SERVICE_DATABASE_URL=postgresql://lyss:lyss123@localhost:5433/lyss_provider_db
DB_HOST=localhost
DB_PORT=5433
DB_USER=lyss
DB_PASSWORD=lyss123
DB_NAME=lyss_provider_db
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_ECHO=false

# Redis配置 (用于缓存和分布式锁)
PROVIDER_SERVICE_REDIS_URL=redis://localhost:6380/2
REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_PASSWORD=
REDIS_DB=2
REDIS_POOL_SIZE=20
REDIS_TIMEOUT=30

# JWT配置 (用于验证来自API Gateway的请求)
PROVIDER_SERVICE_JWT_SECRET=your-super-secret-jwt-key-min-32-chars
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=1440

# 加密配置 (用于加密存储API密钥)
PROVIDER_SERVICE_ENCRYPTION_KEY=your-32-char-encryption-key-here
ENCRYPTION_ALGORITHM=AES-256-GCM

# API限流配置
RATE_LIMIT_REQUESTS=1000
RATE_LIMIT_WINDOW=60
RATE_LIMIT_STORAGE_URL=redis://localhost:6380/3

# Channel健康检查配置
HEALTH_CHECK_INTERVAL=60
HEALTH_CHECK_TIMEOUT=30
HEALTH_CHECK_MAX_RETRIES=3
HEALTH_CHECK_RETRY_DELAY=5

# 供应商API超时配置
DEFAULT_PROVIDER_TIMEOUT=30
DEFAULT_PROVIDER_MAX_RETRIES=3
DEFAULT_PROVIDER_RETRY_DELAY=1

# 负载均衡配置
LOAD_BALANCER_ALGORITHM=weighted_random
LOAD_BALANCER_HEALTH_FACTOR=0.8
LOAD_BALANCER_RESPONSE_TIME_FACTOR=0.2

# 监控和日志配置
ENABLE_REQUEST_LOGGING=true
ENABLE_PERFORMANCE_METRICS=true
ENABLE_HEALTH_CHECKS=true
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false

# 文件上传配置
MAX_REQUEST_SIZE=10485760  # 10MB
MAX_UPLOAD_SIZE=52428800   # 50MB

# CORS配置
CORS_ORIGINS=["http://localhost:3000", "https://lyss.dev"]
CORS_METHODS=["GET", "POST", "PUT", "DELETE", "OPTIONS"]
CORS_HEADERS=["*"]

# 外部服务URL配置 (本地启动模式)
USER_SERVICE_URL=http://localhost:8002
AUTH_SERVICE_URL=http://localhost:8001
CHAT_SERVICE_URL=http://localhost:8004
MEMORY_SERVICE_URL=http://localhost:8005

# OpenTelemetry配置 (可选)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_SERVICE_NAME=lyss-provider-service
OTEL_SERVICE_VERSION=1.0.0
ENABLE_TRACING=false

# Prometheus监控配置
PROMETHEUS_METRICS_PATH=/metrics
ENABLE_PROMETHEUS=false

# 开发环境特殊配置
DEV_AUTO_RELOAD=true
DEV_MOCK_CREDENTIALS=false
DEV_BYPASS_AUTH=false

# 生产环境安全配置 (仅生产环境使用)
SECURE_COOKIES=true
SECURE_HEADERS=true
FORCE_HTTPS=true

# 供应商特定配置 (用于默认配置)
OPENAI_DEFAULT_TIMEOUT=30
OPENAI_DEFAULT_MAX_TOKENS=4000
ANTHROPIC_DEFAULT_TIMEOUT=30
ANTHROPIC_DEFAULT_MAX_TOKENS=4000
GOOGLE_DEFAULT_TIMEOUT=30
DEEPSEEK_DEFAULT_TIMEOUT=30

# Channel管理配置
DEFAULT_CHANNEL_PRIORITY=1
DEFAULT_CHANNEL_WEIGHT=100
DEFAULT_MAX_REQUESTS_PER_MINUTE=1000
MIN_CHANNEL_SUCCESS_RATE=0.8

# 请求日志清理配置
REQUEST_LOG_RETENTION_DAYS=30
CLEANUP_SCHEDULE="0 2 * * *"  # 每天凌晨2点清理
ENABLE_AUTO_CLEANUP=true

# 配额管理配置
DEFAULT_DAILY_REQUEST_LIMIT=10000
DEFAULT_DAILY_TOKEN_LIMIT=1000000
DEFAULT_MONTHLY_REQUEST_LIMIT=300000
DEFAULT_MONTHLY_TOKEN_LIMIT=30000000
QUOTA_RESET_TIMEZONE=Asia/Shanghai

# 缓存配置
CACHE_PROVIDER_CONFIGS_TTL=3600      # 1小时
CACHE_CHANNEL_METRICS_TTL=300        # 5分钟
CACHE_HEALTH_STATUS_TTL=60           # 1分钟
CACHE_CREDENTIALS_TTL=1800           # 30分钟

# 告警配置
ALERT_WEBHOOK_URL=
ALERT_CHANNEL_FAILURE_THRESHOLD=5
ALERT_SUCCESS_RATE_THRESHOLD=0.9
ALERT_RESPONSE_TIME_THRESHOLD=5000   # 5秒